{"posts":[{"title":"TRAFFIC ANALYSIS EXERCISE - TECSOLUTIONS","text":"2020-07-31 - TRAFFIC ANALYSIS EXERCISE - TECSOLUTIONS 学习记录HTTP流首先过滤HTTP流并追踪 发现域名e-dsm.com.br返回了一个doc文件 域名jambino.us返回了一个exe可执行文件 随后不断的向201.235.10.215 IP地址POST数据 将doc文件和exe文件导出（注意：请勿在个人电脑上导出，请在虚拟机内导出） 使用binwalk对doc文件进行分析 使用foremost将文件导出，发现有一个ole文件夹和一个zip文件夹，zip文件内为xml文件 计算.ole文件的MD5值，并在virustotal内查询，发现其为木马下载器，那么后续exe文件则为可执行木马程序 计算exe文件的MD5值，并在virustotal内查询，确定其为木马程序 C2流量下载木马程序之后，主机10.7.31.101与主机为201.235.10.215、104.236.52.89:8080交互频繁 加密流无可疑地址 其他流10.7.31.101发出NBNS注册请求到 NBNS 服务器，其计算机名为DESKTOP-DPHW305&lt;20&gt; (Server service) 通过过滤条件kerberos.CNameString来查找账户名称 Kerberos 是一个网络身份验证协议，用于在不安全的网络中安全地验证用户和服务之间的身份。 以下是 Kerberos 协议的工作原理： 认证服务器（AS）：用户向 Kerberos 认证服务器请求访问服务。AS 验证用户的身份，并生成用于与 Ticket Granting Server (TGS) 通信的 Ticket-Granting Ticket (TGT)。TGT 是受加密保护的，只有 TGS 可以解密它。 票证授予服务器（TGS）：用户收到 TGT 后，可以使用它向 TGS 请求访问特定的服务。用户向 TGS 提交 TGT 和服务标识符的请求。TGS 验证用户的 TGT，并生成一个用于访问特定服务的服务票证（Service Ticket）。服务票证也是受加密保护的。 服务请求：用户收到服务票证后，可以将它与服务请求一起发送给服务。服务收到请求后，使用它和自己的密钥解密服务票证。如果票证有效且未被篡改，服务将向用户提供所需的服务。 线索梳理 Environment（调查的资产信息/环境） LAN segment range:10.07.31.0/24 Domain:tecsolutions.info Domain controller:10.07.31.7 LAN segment gateway:10.07.31.1 LAN segment broadcast address:10.07.31.255 Incident Report Executive summary:用户gregory.simmons被木马感染 Victim details（受害者细节） IP address: 10.7.31.101 MAC address: 00:0c:6e:12:af:38 User account name: gregory.simmons Indicators of compromise (IOCs) SHA256 hash:0a3aaa398a6abe7a4ba256812b8b6632fa4595b4ac5c47b459d5a6a911c2d202 File size:913,503 字节 File name:3tknamb7298632293.exe File location:http://jambino.us/tv/DYsPb/ File description:可执行文件 HTTP traffic to retrieve the malware 191 2020-07-31 08:25:37.088661 10.7.31.101 191.6.208.51 HTTP e-dsm.com.br GET /www/ZdJCAB/ HTTP/1.1 http (80) 49737 (49737) 488 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 531 2020-07-31 08:26:19.877245 10.7.31.101 67.20.112.81 HTTP jambino.us GET /tv/DYsPb/ HTTP/1.1 http (80) 49751 (49751) 123 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 HTTP traffic for remote request infection activity 1493 2020-07-31 08:26:34.733614 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /RLVIcVHpdWjKMHfJsK/bhAzHJy/vazwovI5B9BcchWQ/d0EvU2Xl/HQ7AQetdQggMrPULmis/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1649 2020-07-31 08:26:56.312136 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /M7aBEffyXE/Upa44JYc0iD8C5Co5qj/QxcEX6A0fDBvDo/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1675 2020-07-31 08:26:57.327828 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /y1Oc/CRTtjoStAe/03wHuC/ HTTP/1.1 http-alt (8080) 49817 (49817) 570 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1842 2020-07-31 08:27:13.551157 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /2lOJG5Lepy9SF/6rmms2u4C61LmFD/hJubcUz/13vVTTA5/kRmZYIUJ67VF1I/GyiwnO6oOQatOesN4K/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 1881 2020-07-31 08:27:19.007452 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /qKSwAKe1Mi/y5QsEBixxmL45MPHwaD/smvp/78W7iuovnPDTvP2w/10jxRo2zF6M/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2003 2020-07-31 08:27:29.328238 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /o9O08G04DzIZG8OWRp/ HTTP/1.1 http (80) 49815 (49815) 414 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2543 2020-07-31 08:28:12.784950 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /LCWZY47XwmugeO3/3z2TvDhczd/ HTTP/1.1 http (80) 49815 (49815) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2558 2020-07-31 08:28:12.975985 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /rQDNZBxm3Rpz/YdX3soU3MRPD/fXFnwkKVcXuwwBkpsSq/ HTTP/1.1 http-alt (8080) 49825 (49825) 350 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2685 2020-07-31 08:28:28.385792 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /aNIce30YT/xzZyFctinQ3Jkn/ HTTP/1.1 http (80) 49815 (49815) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 2697 2020-07-31 08:28:28.655094 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /RaGu/PUTIkmMWtxHtctq/du2EPQGClXV/ HTTP/1.1 http-alt (8080) 49826 (49826) 1490 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 3260 2020-07-31 08:29:21.910776 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /4DsE/ HTTP/1.1 http (80) 49815 (49815) 382 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 3861 2020-07-31 08:43:48.725324 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /NemVGY4zT/f6eDx8v6CbHNUXS/gjuMfPtC/j2SXoNwzJzR/ HTTP/1.1 http (80) 49985 (49985) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4037 2020-07-31 08:44:31.428936 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /yguqyvZp1YxK083S/H5kIaZFW692xUc/HLuonj6146/ HTTP/1.1 http (80) 49985 (49985) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4064 2020-07-31 08:44:36.331335 10.7.31.101 104.236.52.89 HTTP 104.236.52.89:8080 POST /xian/balloon/ HTTP/1.1 (application/x-www-form-urlencoded) http-alt (8080) 49987 (49987) 722 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4178 2020-07-31 08:59:10.832559 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /VmjfI/jygtnUpXR/kxLUe7h097jcjEAJPIM/u8O5/jHD8f/NiJ7CP0jmzegr/ HTTP/1.1 http (80) 49989 (49989) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4414 2020-07-31 08:59:26.656364 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /FlpErlAFJoc1f77w3J/ HTTP/1.1 http (80) 49989 (49989) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 4574 2020-07-31 09:13:59.964790 10.7.31.101 201.235.10.215 HTTP 201.235.10.215 POST /RoEy0QXUh0/ HTTP/1.1 http (80) 49999 (49999) 366 ASUSTekCOMPU_12:af:38 Cisco_79:48:c2 INVESTIGATION 首先检查http传输的exe可执行文件 发现C2流量 知识DCERPC DCERPC（Distributed Computing Environment Remote Procedure Calls）是一种远程过程调用（RPC）协议，用于在分布式计算环境中进行通信。它最初是由OSF（Open Software Foundation）开发的，后来成为了 DCE（Distributed Computing Environment）标准的一部分。 DRSUAPI DRSUAPI（Directory Replication Service Remote Administration Interface）是用于管理 Windows 活动目录（Active Directory）复制服务的远程管理接口。它提供了一组用于管理和监视活动目录复制的远程过程调用（RPC）接口。 LLMNR LLMNR 是 Link-Local Multicast Name Resolution 的缩写，是一种用于在局域网中进行主机名解析的协议。它通常用于 Windows 系统中，并且是 Windows Vista 及更高版本中的默认网络服务之一。 LDAP LDAP 是 Lightweight Directory Access Protocol 的缩写，是一种用于访问和维护分布式目录服务的协议。它最初是由大学提供的工具和服务的联合开发团队（University of Michigan）开发的，并成为了互联网工程任务组（IETF）的标准协议。 参考TECSOLUTIONS - Traffic Analysis Train 2020-07-31-traffic-analysis-exercise-answers.pdf","link":"/20200731-Malware/"},{"title":"PCAP AND INFO FOR AN ISC DIARY","text":"2020-08-04 - PCAP AND INFO FOR AN ISC DIARY 学习记录HTTP流首先查看http流，并追踪第一条流 发现其传输的是一个可执行程序 查询请求的域名，发现其为恶意地址 导出该文件（注意：请勿在个人电脑中导出，请在虚拟机中导出） 该图片打不开 使用二进制分析攻击binwalk进行分析： 0x0: 这是一个Microsoft可执行文件，采用了可移植执行格式（PE）。 0x457F5: 这是一个bix头部，具有一些元数据信息，包括创建时间、数据地址、入口点等。其OS标记为4.4BSD，名称为”lXD”。 0x56639: 这也是一个bix头部，但这个文件看起来像是固件映像（Firmware Image）。 0x6F484: 这是一个Base64标准索引表。 0x73C70 和 0x73C9F: 这是HTML文档的头部和尾部。 0x74160 和 0x7418F: 这是另一个HTML文档的头部和尾部。 0xC3EE0 和 0xC3F09: 这是一个PNG图像和相应的Zlib压缩数据。 使用foremost分离该文件，得到exe文件和png图片 查看exe文件的md5值，并通过virustotal查询 加密流无可疑流 线索梳理 恶意网站：aromaterapiaclinicabrasil.com.br 恶意文件：87411326.jpg 感染过程：受害者主机10.8.4.101 访问恶意网站aromaterapiaclinicabrasil.com.br后，下载图片形式的恶意文件87411326.jpg，该文件本质是一个exe文件，用excel的图标进行伪装，欺骗用户点击从而感染 知识IGMPv3 IGMPv3（Internet Group Management Protocol version 3）是一种用于在IPv4网络中管理组成员关系的协议。它是IGMP协议的升级版本，主要用于在多播环境下管理主机和路由器之间的通信。 NBNS NBNS（NetBIOS Name Service）是NetBIOS的一部分，用于在局域网中将NetBIOS名（通常是计算机名）解析为IP地址。NetBIOS是一种早期的局域网通信协议，用于在局域网中提供命名、会话和数据共享服务。 参考Pcap and alerts for an ISC diary - Traffic Analysis Train","link":"/20200804-Malware/"},{"title":"TRAFFIC ANALYSIS EXERCISE - PIZZA-BENDER","text":"2020-08-21 - TRAFFIC ANALYSIS EXERCISE - PIZZA-BENDER 学习记录HTTP流首先查看HTTP流追踪第一条流，可以看到传输的是一个DLL可执行程序通过virustotal查询访问域名ncznw6a.com，发现该域名存在恶意行为随后请求域名ctldl.windowsupdate.com，IP为8.252.146.254，均返回304。 加密流通过查看TLS流，发现除了知名的域名，存在其他域名如 恶意软件后续是否可以通过软件分析？ 可疑地址 HOST IP ldrbravo.case 45.147.231.132 sieseetera.club 89.44.9.186 ciliabba.cyou 89.44.9.186 ubbifeder.cyou 89.44.9.186 知识LDAP协议 LDAP（轻量级目录访问协议，Lightweight Directory Access Protocol）是一种用于在网络上访问和维护目录服务的协议。目录服务是一种存储和组织信息的分层数据库，通常用于存储用户、组织、设备等信息，并提供快速和有效的检索功能。 KRB5 KRB5 是 Kerberos 5 的缩写，是一种用于网络身份验证的协议。Kerberos 是一种计算机网络身份验证协议，旨在提供强大的身份验证机制，确保只有合法用户能够访问网络资源。 SAMR SAMR（Security Accounts Manager Remote Protocol）是一种用于远程管理 Windows 操作系统用户和组的协议。它允许远程客户端应用程序通过网络与 Windows 系统上的安全账户管理器（SAM）进行通信，从而实现对用户账户、组账户和域账户等的管理操作。 SMB2 SMB2（Server Message Block version 2）是一种用于在计算机网络上共享文件、打印机、串口及其他资源的协议。它是 SMB（Server Message Block）协议的更新版本，旨在提供更快、更安全和更可靠的文件共享服务。 参考PIZZA-BENDER - Traffic Analysis Train","link":"/20200821-Malware/"},{"title":"DATA DUMP FROM LATRODECTUS INFECTION","text":"2024-04-09 (TUESDAY): DATA DUMP FROM LATRODECTUS INFECTION 学习记录HTTP流通过命令http.response.code==200查看返回成功的http流量，并逐一追踪 这个交互看起来像是进行了一个 OCSP（在线证书状态协议）查询。在此查询中，客户端请求某个证书的状态，而服务器（ocsp.digicert.com）则返回了该证书的状态信息（即 OCSP 响应） 第二条流请求了证书 第三条流是一个 OPTIONS 请求，用于查询服务器支持的方法。87.249.49.206服务器返回了状态码 200 OK，表示请求成功，并在响应头部中列出了服务器支持的方法，包括 OPTIONS, HEAD, GET, PROPFIND, DELETE, COPY, MOVE, PROPPATCH, LOCK, UNLOCK 第四条流是一个 OPTIONS 请求，用于查询87.249.49.206服务器对 /share 资源支持的方法。服务器返回了状态码 200 OK，表示请求成功，并在响应头部中列出了服务器支持的方法，包括 OPTIONS, HEAD, GET, PROPFIND, DELETE, COPY, MOVE, PROPPATCH, LOCK, UNLOCK 第五条流，请求服务器/share/esetond.msi，服务器返回了一个.msi文件 查询域名发现其可能为恶意地址 将.msi文件的sha256值在virustotal中查询，发现其为恶意软件 .MSI文件分析一些恶意代码可能嵌入到.msi文件中，故通过Orca[1]对.MSI文件进行分析，[分析方法][2]参考（注意：请勿在个人电脑上分析，请在虚拟机内分析） 其二进制表如下，其中包括exe、jpg、dll以及其他格式的二进制文件 其文件表只包含一个Util.dll文件 组件表是具有用于指定将.cab中存在的文件安装到哪里的功能表 控制表（我猜是用于程序的控制，比如PushButton） CustomAction Table 参考里面说是最重要的表格。（不知道都运行了什么0.0）多数Action运行了aicustact.dll 使用 msi 的注册表功能在注册表键 Software\\[Manufacturer]\\[ProductName]中注册值 没有发现任何线索，可能我的分析方法有问题，如果有任何建议请访问我的twitter，联系我。 利用foremost对msi文件进行分离 查看exe文件的sha256值，并通过virustotal查询，发现其为AIDetectMalware， dll文件未发现问题 加密流在获取.msi文件之前，受害主机和87.249.49.206进行了一段时间的加密通信 问题并没有发现题目里提供的文件（大失败 T T，如果你发现了请联系我twitter） 线索梳理 Environment（调查的资产信息/环境） LAN segment range:10.4.9.0/24 Domain:- Domain controller:10.4.9.1 LAN segment gateway:10.4.9.1 LAN segment broadcast address:10.4.9.255 Incident Report Executive summary:用户被嵌入恶意软件的.msi文件感染 Victim details IP address:10.4.9.101 MAC address:00:26:c7:2f:c6:7e User account name:- Indicators of compromise (IOCs) SHA256 hash:08075e8a6dcc6a5fca089348edbd5fc07b2b0b26a26a46e0dd401121fdaa88d3 File size:1,649,664 字节 File name:esetnod.msi File location:http://kosukeshimura.com/share/esetnod.msi File description:被恶意软件嵌入的.msi文件 HTTP traffic to retrieve the malware 5663 2024-04-10 07:44:29.351877 10.4.9.101 87.249.49.206 HTTP kosukeshimura.com GET /share/esetnod.msi HTTP/1.1 http (80) 50367 (50367) 246 Intel_2f:c6:7e Cisco_30:22:43 知识参考[1]:Orca.exe - Win32 apps | Microsoft Learn [2]:.msi malware analysis","link":"/20240409-Malware/"},{"title":"Welcome to My Blog","text":"Welcome to my first blog! I'm thrilled to embark on this journey where I'll be sharing my study experiences, code snippets, and insights into life. It's my pleasure to meet you all! Stay tuned as I continuously improve and enhance the functionality of this blog. As a beginner, if you have any questions or suggestions, please contacting me at any time via twitter. I will do my best to provide support.","link":"/first/"}],"tags":[],"categories":[{"name":"malware_traffic","slug":"malware-traffic","link":"/categories/malware-traffic/"},{"name":"explanation","slug":"explanation","link":"/categories/explanation/"}],"pages":[{"title":"about","text":"","link":"/about/index.html"},{"title":"Life","text":"About My Life","link":"/life/index.html"}]}